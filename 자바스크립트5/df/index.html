<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
    <script>							
        // 1. 지도 띄우기
        map = new Tmap.Map({
            div : 'map_div',
            width : "100%",
            height : "400px",
        });
        map.setCenter(new Tmap.LonLat("126.986072", "37.570028").transform("EPSG:4326", "EPSG:3857"), 15);
        //현재위치의 바로 이전위치를 그릴 레이어 생성
        beforeMarkerLayer = new Tmap.Layer.Markers();
        //현재위치를 그릴 레이어 생성
        markerLayer = new Tmap.Layer.Markers();
        
            // 2. 위치 조회
            if(window.XMLHttpRequest){
                   xhttp=new XMLHttpRequest();
               }else{
                   xhttp=new ActiveXObject("Microsoft.XMLDOM");
               }
            
            xhttp.open("GET","/web/usecase/sample.kml",false);
            xhttp.send();
            var prtcl =  xhttp.responseXML;
        
            var markerLayer = new Tmap.Layer.Markers();
            var beforeMarkerLayer = new Tmap.Layer.Markers();
            map.addLayer(beforeMarkerLayer);
            map.addLayer(markerLayer);
            var size = new Tmap.Size(24, 38);
            var offset = new Tmap.Pixel(-(size.w / 2), -(size.h));
            var maker;
            var beforeMarker;
            var popup,popup2;
            var beforePopup,beforePopup2;
            var prtclString = new XMLSerializer().serializeToString(prtcl);//xml to String	
            xmlDoc = $.parseXML( prtclString ),
            $xml = $( xmlDoc ),
            $intRate = $xml.find("Placemark");
            
            function myFunction(cnt, checkLevel){
                    $intRate.each(function(index, element) {
                        var name = element.getElementsByTagName("name")[0].childNodes[0].nodeValue;
                        var number = element.getElementsByTagName("number")[0].childNodes[0].nodeValue;
                        var affiliation = element.getElementsByTagName("affiliation")[0].childNodes[0].nodeValue;
                        var distance = element.getElementsByTagName("distance")[cnt].childNodes[0].nodeValue;
                        var speed = element.getElementsByTagName("speed")[cnt].childNodes[0].nodeValue;
                        var content = 
                                    '<div class="wrap">' + 
                                    '    <div class="info">' + 
                                    '        <div class="title">' + 
                                    '            '+name + 
                                    '        </div>' + 
                                    '        <div class="body">' + 
                                    '            <div class="desc">' + 
                                    '                <div><span>차량번호</span> '+number+'</div>' +  
                                    '                <div><span>소속지사</span> '+affiliation+'</div>' + 
                                    '                <div><span>운행거리</span> '+distance+'km</div>' + 
                                    '                <div><span>현재속도</span> '+speed+'km/h</div>' + 
                                    '            </div>' + 
                                    '        </div>' + 
                                    '    </div>' +     
                                    '</div>';
                                    
                        //현재위치 바로 이전 위치를 그리기 위한 부분
                        if(cnt > 0 && cnt >= 1 && cnt < 42 && checkLevel != 4){
                            //현재위치 갱신후 이전위치에 있던 마커 삭제
                            markerLayer.clearMarkers();
                            
                            var beforePoint = element.getElementsByTagName("coordinates")[cnt-1].childNodes[0].nodeValue.split(',');
                            var beforeIcon = new Tmap.Icon('/resources/images/common/before_car.png',size, offset);
                            var beforeLonlat = new Tmap.LonLat(beforePoint[0],beforePoint[1]).transform("EPSG:4326", "EPSG:3857");
                            beforeMarker = new Tmap.Marker(beforeLonlat, beforeIcon);
                            
                            beforeMarkerLayer.addMarker(beforeMarker);
                            
                            beforePopup = new Tmap.Popup("p1", beforeLonlat, new Tmap.Size(130, 130), content, true);//마우스 오버 팝업
                            beforePopup2 = new Tmap.Popup("p2", beforeLonlat, new Tmap.Size(130, 130), content, true);//마우스 클릭 팝업
                            map.addPopup(beforePopup);
                            map.addPopup(beforePopup2);
                            beforePopup.hide();
                            beforePopup2.hide();
                            //마커 이벤트등록
                            beforeMarker.events.register("mouseover", beforePopup, onOverMarker);
                            function onOverMarker(evt) {
                                this.show(); //마커에 마우스가 오버되었을 때 팝업이 보입니다. 
                            }
                            beforeMarker.events.register("mouseout", beforePopup, onOutMarker);
                            function onOutMarker(evt) {
                                this.hide(); //마커에 마우스가 없을땐 팝업이 숨겨집니다.
                            }
                            beforeMarker.events.register("click", beforePopup2, onClickMarker);
                            function onClickMarker(evt) {
                                this.show(); //마커에 마우스가 클릭되었을 때 팝업이 보입니다. 
                            }
                        }
                        
                        var point = element.getElementsByTagName("coordinates")[cnt].childNodes[0].nodeValue.split(',');
                        console.log(point[0]+","+point[1]);
                        var icon = new Tmap.Icon('/resources/images/common/pin_car.png',size, offset);
                        var lonlat = new Tmap.LonLat(point[0],point[1]);
                        console.log(lonlat.toShortString());
                        marker = new Tmap.Marker(lonlat, icon);
                        markerLayer.addMarker(marker);
                        
                        popup = new Tmap.Popup("p1", lonlat, new Tmap.Size(130, 130), content, true);//마우스 오버 팝업
                        popup2 = new Tmap.Popup("p2", lonlat, new Tmap.Size(130, 130), content, true);//마우스 클릭 팝업
                        map.addPopup(popup);
                        map.addPopup(popup2);
                        popup.hide();
                        popup2.hide();
                        //마커 이벤트등록
                        marker.events.register("mouseover", popup, onOverMarker);
                        function onOverMarker(evt) {
                          this.show(); //마커에 마우스가 오버되었을 때 팝업이 보입니다. 
                        }
                        marker.events.register("mouseout", popup, onOutMarker);
                        function onOutMarker(evt) {
                          this.hide(); //마커에 마우스가 없을땐 팝업이 숨겨집니다.
                        }
                        marker.events.register("click", popup2, onClickMarker);
                        function onClickMarker(evt) {
                            this.show(); //마커에 마우스가 클릭되었을 때 팝업이 보입니다. 
                        }
                    });
                }
                myFunction(0);
            
        
            // 3. 위치 관제 시작
            var cnt = 1;
            myVar = setInterval(function(){
                var count = $xml.find("Placemark")[0].getElementsByTagName("coordinates").length;
                if(cnt == count){
                    cnt = 0;
                    //리셋
                    markerLayer.clearMarkers();
                    beforeMarkerLayer.clearMarkers();
                }
                myFunction(cnt);
                cnt++;
            }, 1000);
            
            
        </script>	
                        
        
                    
        
    <!-- <script>
        alert('alert()함수의 출력')  //경고창을 출력
        console.log('console.log()메소드의 출력')    //콘솔에 출력
        let a = 0
        console.log(a++)    //0
        console.log(a)      //1

        let b = 0
        console.log(++b)    //1
        console.log(b)      //1

         prompt("message"," value");    //message창이 하나 뜸
         const c = prompt("아무값이나 입력해주세요", "");
         //팝업창에 입력을하면 
        //  a는 팝업창에 입력한 값을 가지게 된다

        const a = prompt('첫 번째 숫자를 입력해주세요');
        //==const a = Number(prompt('첫 번째 숫자를 입력해주세요'))
        
        const b =prompt('두 번째 숫자를 입력해주세요');
        //==const b = Number(prompt('첫 번째 숫자를 입력해주세요'))
        alert(`${a} + ${b} = ${a+b}`);

    </script> -->
</head>
<body>

</body>
</html>
